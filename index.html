<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>bonsai4d</title>

  <style>
    :root{
      --bg1:#094d1b;
      --bg2:#000000e0;
      --bg3:#07caba;
      --card: rgba(255,255,255,.07);
      --stroke: rgba(255,255,255,.14);
      --gold1:#FFD700;
      --gold2:#B8860B;
    }

    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      color:#fff;
      min-height:100vh;
      background: linear-gradient(135deg,var(--bg1),var(--bg2),var(--bg3));
      background-attachment: fixed;
    }

    /* ====== Lightning layer (simple) ====== */
    .fx{
      position:fixed; inset:0;
      pointer-events:none;
      z-index:-1;
    }
    .fx .flash{position:absolute; inset:0; background:#fff; opacity:0;}
    #lightningCanvas{width:100%; height:100%; display:block;}

    /* ====== Layout ====== */
    .container{
      max-width:1100px;
      margin:0 auto;
      padding:18px;
    }
    header{
      text-align:center;
      padding:10px 10px 18px;
    }
    .logo{
  width:600px;          /* BESAR di desktop */
  max-width:92vw;       /* tetap aman kalau layar kecil */
  height:auto;
  display:block;
  margin:0 auto;
  filter:drop-shadow(0 10px 22px rgba(0,0,0,.55));
}

/* ===== HP / Android ===== */
@media (max-width:480px){
  .logo{
    width:80vw;         /* lebih kecil di HP */
  }
}
    .grid{
      display:grid;
      grid-template-columns: 380px 1fr;
      gap:22px;
      align-items:start;
      margin-top:10px;
    }

    /* HP: jadi 1 kolom */
    @media (max-width: 900px){
      .grid{grid-template-columns: 1fr;}
    }

    /* ====== Wheel ====== */
    .wheel-wrap{
      width:min(360px, 92vw);
      aspect-ratio: 1 / 1;
      margin:0 auto;
      position:relative;
    }
    .pointer{
      position:absolute;
      top:-18px; left:50%;
      transform:translateX(-50%);
      width:48px; height:58px;
      z-index:5;
    }
    .outer{
      width:100%; height:100%;
      border-radius:50%;
      padding:14px;
      background:linear-gradient(to bottom,var(--bg2),var(--bg3));
      border:4px solid #000;
      box-shadow:0 0 50px rgba(0,0,0,.55);
    }
    .wheel {
      width: 100%; 
      height: 100%;
      border-radius: 50%;
      border: 4px solid #000;
      position: relative;
      /* Perbaikan di bawah ini: */
      background: conic-gradient(
        #8f8686 0deg 60deg,
        #035245 60deg 120deg,
        #8f8686 120deg 180deg,
        #035245 180deg 240deg,
        #8f8686 240deg 300deg,
        #d7ff5a 300deg 360deg
      );
      transform: rotate(0deg);
    }
    .wheel.spinning{
      animation: spin 6s cubic-bezier(0.15,0,0.15,1) forwards;
    }
    @keyframes spin{
      from{transform:rotate(0deg)}
      to{transform:rotate(var(--rot))}
    }

    .center{
      position:absolute; inset:0;
      display:grid; place-items:center;
      pointer-events:none;
    }
    .center > div{
      width:64px;height:64px;border-radius:50%;
      background:linear-gradient(135deg,var(--gold1),var(--gold2));
      border:4px solid rgba(0,0,0,.65);
      position:relative;
      box-shadow:0 10px 18px rgba(0,0,0,.45);
    }
    .center > div:after{
      content:"";
      position:absolute; inset:12px;
      border-radius:50%;
      background:#f70000;
    }

    .prize{
      position:absolute;
      font-weight:900;
      font-size:20px;
      transform: translate(-50%,-50%);
      user-select:none;
      white-space:nowrap;
    }

    /* ====== Card (Input + Table) ====== */
    .card{
      background:var(--card);
      border:1px solid var(--stroke);
      border-radius:16px;
      padding:16px;
      backdrop-filter: blur(6px);
    }
    h2{margin:0 0 10px; font-size:18px}
    .hint{opacity:.85; font-size:13px; margin-bottom:12px}

    input{
      width:100%;
      height:52px;
      border-radius:12px;
      border:1px solid rgba(255,255,255,.2);
      background:rgba(0,0,0,.35);
      color:#00ff00;
      text-align:center;
      font-size:16px;
      outline:none;
      margin-bottom:10px;
    }
    button{
      width:100%;
      height:56px;
      border:0;
      border-radius:12px;
      cursor:pointer;
      font-weight:900;
      letter-spacing:.6px;
      background:linear-gradient(#fff,#fff);
      color:#000;
    }
    button:disabled{opacity:.55; cursor:not-allowed}

    .table{
      margin-top:14px;
      border-radius:14px;
      overflow:hidden;
      border:1px solid rgba(255,255,255,.12);
      background:rgba(0,0,0,.22);
    }
    .thead,.trow{
      display:grid;
      grid-template-columns: 54px 1fr 120px;
      gap:10px;
      padding:10px 12px;
      align-items:center;
    }
    .thead{
      position:sticky; top:0;
      background:rgba(0,0,0,.55);
      font-weight:900;
      color:var(--gold1);
    }
    .tbody{
      max-height:260px;
      overflow:auto;
    }
    .prize-amt{ text-align:right; font-weight:900; color:#4ade80 }

    /* ====== Modal ====== */
    .modal{
      position:fixed; inset:0;
      display:none;
      align-items:center; justify-content:center;
      background:rgba(0,0,0,.78);
      z-index:1000;
      padding:18px;
    }
    .modal.show{display:flex}
    .modal-box{
      width:min(520px, 96vw);
      background:rgba(10,10,20,.95);
      border:1px solid rgba(255,215,0,.35);
      border-radius:18px;
      padding:22px;
      text-align:center;
    }
    .big{
      font-size:38px;
      font-weight:900;
      color:var(--gold1);
      margin:10px 0 4px;
    }
    .modal-actions{
      display:flex;
      gap:10px;
      justify-content:center;
      flex-wrap:wrap;
      margin-top:14px;
    }
    .btn-ghost{
      background:rgba(255,255,255,.12);
      color:#fff;
      max-width:200px;
    }

    /* ====== License bottom ====== */
    .license{
      position:fixed;
      left:12px;
      right:12px;
      bottom:12px;
      display:flex;
      flex-direction:column;
      align-items:center;
      gap:8px;
      font-size:12px;
      opacity:.95;
      text-shadow:0 2px 6px rgba(0,0,0,.6);
      pointer-events:none; /* biar gak ganggu klik */
    }
    .license .logos{
      display:flex; gap:8px; flex-wrap:wrap;
      justify-content:center;
      pointer-events:auto;
    }
    .license img{height:22px; width:auto; opacity:.92}
  </style>
</head>

<body>
  <div class="fx" aria-hidden="true">
    <div class="flash"></div>
    <canvas id="lightningCanvas"></canvas>
  </div>

  <div class="container">
    <header>
      <img class="logo" src="https://i.imgur.com/ytgmjUZ.png" alt="Logo">
    </header>

    <div class="grid">
      <!-- Wheel -->
      <section>
        <div class="wheel-wrap">
          <div class="pointer">
            <svg viewBox="0 0 48 64" xmlns="http://www.w3.org/2000/svg">
              <path d="M24 60L4 20C4 20 8 4 24 4C40 4 44 20 44 20L24 60Z" fill="#FFD700" stroke="#B8860B" stroke-width="2"/>
              <circle cx="24" cy="16" r="8" fill="#FFF" stroke="#B8860B" stroke-width="2"/>
            </svg>
          </div>

          <div class="outer">
            <div class="wheel" id="wheel">
              <div class="center"><div></div></div>
            </div>
          </div>
        </div>
      </section>

      <!-- Form + Winners -->
      <section class="card">
        <h2>MASUKKAN USER ID</h2>
        <div class="hint">User ID hanya bisa claim 1x, tiket hanya 1x pakai.</div>

        <input id="userIdInput" type="text" placeholder="Contoh: USER123" maxlength="30">
        <input id="ticketInput" type="text" placeholder="Masukkan Kode Tiket" maxlength="40">

        <button id="spinBtn" type="button" disabled onclick="startSpin()">MASUKKAN USER ID & TIKET</button>

        <div class="table" style="margin-top:16px">
          <div class="thead">
            <div>NO</div><div>USER ID</div><div style="text-align:right">HADIAH</div>
          </div>
          <div class="tbody" id="winnersBody"></div>
        </div>
      </section>
    </div>
  </div>

  <!-- Modal -->
  <div class="modal" id="prizeModal">
    <div class="modal-box">
      <h2 style="margin:0">SELAMAT!</h2>
      <div style="opacity:.85;margin-top:6px">Anda mendapatkan</div>
      <div class="big" id="prizeAmount">IDR 1.000</div>

      <div class="modal-actions">
        <button type="button" style="max-width:260px" onclick="claimPrize()">KLAIM SEKARANG</button>
        <button type="button" class="btn-ghost" onclick="closeModal()">TUTUP</button>
      </div>
    </div>
  </div>

  <!-- License -->
  <div class="license">
    <div class="logos">
      <img src="https://idl-cdn.rika.online/idl88/front/as-min.png" alt="logo">
      <img src="https://idl-cdn.rika.online/idl88/front/ayam.png" alt="logo">
      <img src="https://idl-cdn.rika.online/toko4d/front/18.webp" alt="18+">
    </div>
    <div>Â© Copyright 2014 - 2025. All Rights Reserved. | 18+</div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.0/dist/confetti.browser.min.js"></script>
  <script>
    // ====== CONFIG ======
    const TICKET_API = "https://orange-disk-1954taruna-ticket.mahikaleverin21.workers.dev/"; // ganti ke URL Worker kamu
    const PRIZES = ["1K", "50K", "3K", "10K", "500K", "1JT"];
    const AMOUNTS = ["1.000", "50.000", "3.000", "10.000", "500.000", "1.000.000"];

    function pickPrizeIndex(){
      const r = Math.random() * 100;
      if (r < 60) return 0;  // 1K
      if (r < 90) return 2;  // 3K
      return 3;              // 10K
    }

    // ====== STATE ======
    let spinning = false;
    let currentRot = 0;
    let winners = [];

    // ====== UI ======
    const $ = (id)=>document.getElementById(id);
    const normalize = (s)=>(s||"").toString().trim().toUpperCase();

    function setBtn(){
      const userOk = $("userIdInput").value.trim().length > 0;
      const ticketOk = normalize($("ticketInput").value).length > 0;
      const ok = userOk && ticketOk && !spinning;

      const btn = $("spinBtn");
      btn.disabled = !ok;
      btn.textContent = spinning ? "SPINNING..." : (ok ? "SPIN SEKARANG!" : "MASUKKAN USER ID & TIKET");
    }

    function drawLabels(){
      const wheel = $("wheel");
      wheel.querySelectorAll(".prize").forEach(e=>e.remove());

      const seg = 360 / PRIZES.length;
      PRIZES.forEach((txt,i)=>{
        const ang = i*seg + seg/2;
        const r = 108; // radius label
        const x = Math.cos((ang-90)*Math.PI/180)*r;
        const y = Math.sin((ang-90)*Math.PI/180)*r;

        const el = document.createElement("div");
        el.className="prize";
        el.textContent=txt;

        const isLight = (i+1)%2===0;
        el.style.color = isLight ? "#000" : "#fff";
        el.style.textShadow = isLight ? "none" : "0 2px 4px rgba(0,0,0,.55)";

        el.style.left = `calc(50% + ${x}px)`;
        el.style.top  = `calc(50% + ${y}px)`;
        wheel.appendChild(el);
      });
    }

    function renderWinners(){
      const body = $("winnersBody");
      body.innerHTML = "";
      winners.forEach((w, i)=>{
        const row = document.createElement("div");
        row.className="trow";
        row.innerHTML = `
          <div>${i+1}</div>
          <div style="font-weight:700">${w.user}</div>
          <div class="prize-amt">IDR ${w.amount}</div>
        `;
        body.appendChild(row);
      });
    }

    function mockWinners(){
      const arr=[];
      for(let i=0;i<50;i++){
        arr.push({
          user:`USER${Math.floor(Math.random()*9000)+1000}***`,
          amount: AMOUNTS[Math.floor(Math.random()*AMOUNTS.length)]
        });
      }
      return arr;
    }

    function celebrate(){
      const end = Date.now() + 1800;
      (function frame(){
        confetti({ particleCount: 6, angle: 60, spread: 55, origin:{x:0} });
        confetti({ particleCount: 6, angle: 120, spread: 55, origin:{x:1} });
        if(Date.now()<end) requestAnimationFrame(frame);
      })();
    }

    function closeModal(){ $("prizeModal").classList.remove("show"); }
    function claimPrize(){ window.location.href = "https://rb.gy/cwhqzq"; } // isi link klaim kamu

    // ====== MAIN ======
    async function startSpin(){
      const userId = $("userIdInput").value.trim();
      const ticket = normalize($("ticketInput").value);

      if(!userId) return alert("Masukkan User ID dulu!");
      if(!ticket) return alert("Masukkan Kode Tiket dulu!");
      if(spinning) return;

      spinning = true; setBtn();
      $("spinBtn").textContent = "CEK TIKET...";

      let data;
      try{
        const res = await fetch(TICKET_API,{
          method:"POST",
          headers:{ "Content-Type":"application/json" },
          body: JSON.stringify({ userId, ticket })
        });
        const raw = await res.text();
        data = JSON.parse(raw);
      }catch(e){
        spinning=false; setBtn();
        return alert("Worker error / bukan JSON.");
      }

      if(!data?.ok){
        spinning=false; setBtn();
        return alert(data?.msg || "Tiket tidak valid / sudah dipakai.");
      }

      $("spinBtn").textContent = "SPINNING...";

      const prizeIndex = pickPrizeIndex();
      const amount = AMOUNTS[prizeIndex];

      const seg = 360 / PRIZES.length;
      const center = (prizeIndex * seg) + (seg/2);
      const rotationNeeded = 360 - center;
      const fullSpins = 360 * (8 + Math.floor(Math.random() * 4));
      const offset = (Math.random() - 0.5) * (seg * 0.6);

      const mod = currentRot % 360;
      const toZero = 360 - mod;
      const total = currentRot + toZero + fullSpins + rotationNeeded + offset;
      currentRot = total;

      const wheel = $("wheel");
      wheel.classList.add("spinning");
      wheel.style.setProperty("--rot", total + "deg");

      setTimeout(()=>{
        wheel.classList.remove("spinning");
        wheel.style.transform = `rotate(${total}deg)`;

        $("prizeAmount").textContent = `IDR ${amount}`;
        $("prizeModal").classList.add("show");

        winners.unshift({ user:userId, amount });
        winners = winners.slice(0,50);
        renderWinners();

        $("ticketInput").value = "";
        celebrate();

        spinning=false; setBtn();
      }, 6000);
    }

    // ====== INIT ======
    document.addEventListener("DOMContentLoaded", ()=>{
      winners = mockWinners();
      drawLabels();
      renderWinners();

      $("userIdInput").addEventListener("input", setBtn);
      $("ticketInput").addEventListener("input", setBtn);
      setBtn();

      $("prizeModal").addEventListener("click",(e)=>{
        if(e.target.id==="prizeModal") closeModal();
      });
    });

    // ====== Lightning (simple) ======
    (()=>{
      const canvas = document.getElementById("lightningCanvas");
      const ctx = canvas.getContext("2d");
      const flash = document.querySelector(".flash");

      function resize(){
        const dpr = window.devicePixelRatio || 1;
        canvas.width = Math.floor(innerWidth * dpr);
        canvas.height = Math.floor(innerHeight * dpr);
        ctx.setTransform(dpr,0,0,dpr,0,0);
      }
      addEventListener("resize", resize);
      resize();

      const rand=(a,b)=>Math.random()*(b-a)+a;

      function bolt(){
        const w = innerWidth, h = innerHeight;
        let x = rand(0.2*w,0.8*w), y = 0;
        const pts=[{x,y}];
        while(y < h*rand(0.45,0.85)){
          x += rand(-32,32);
          y += rand(18,44);
          pts.push({x,y});
        }

        ctx.clearRect(0,0,w,h);
        ctx.lineJoin="round"; ctx.lineCap="round";

        // glow
        ctx.strokeStyle="rgba(180,220,255,0.32)";
        ctx.lineWidth=6;
        ctx.beginPath(); ctx.moveTo(pts[0].x,pts[0].y);
        for(let i=1;i<pts.length;i++) ctx.lineTo(pts[i].x,pts[i].y);
        ctx.stroke();

        // core
        ctx.strokeStyle="rgba(255,255,255,0.95)";
        ctx.lineWidth=2;
        ctx.beginPath(); ctx.moveTo(pts[0].x,pts[0].y);
        for(let i=1;i<pts.length;i++) ctx.lineTo(pts[i].x,pts[i].y);
        ctx.stroke();

        flash.style.transition="none";
        flash.style.opacity="0.5";
        requestAnimationFrame(()=>{
          flash.style.transition="opacity 420ms ease";
          flash.style.opacity="0";
        });

        setTimeout(()=>ctx.clearRect(0,0,w,h), 220);
      }

      (function loop(){
        setTimeout(()=>{ bolt(); loop(); }, rand(1200,3500));
      })();
    })();
  </script>
</body>
</html>


